function SizeMe(e){$("body").height($(window).outerHeight()-40),$("body").width($(window).outerWidth());var t=($("body").width(),$("body").height(),40),o=151,n=49,i=20;$("#map").height($("body").height()-$("#map").offset().top),$("#menu").height($("#map").height()-t),$("#vcr-controls").css("top",$("#map").offset().top+$("#map").height()-n-i+"px"),$("#SubjectiveMarkers").height($("#menu").height()-o),e.invalidateSize()}$(document).ready(function(){function e(e,n,i){var a=[];a.sort();for(var r in e)a.push('<input type="checkbox" name="SMFilter" value="'+t(e[r])+'">'+e[r]+" &nbsp;&#40;"+n.SMCount[e[r]]+"&#41;</input>");a.sort(),$("#SubjectiveMarkers").html(a.join("<br />")),$("#SubjectiveMarkers").on("click",function(){o(n,i),$(".pause").hide(),$(".play").show(),s(n,i)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),o(n,i),$(".pause").hide(),$(".play").show(),s(n,i)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),o(n,i)}),$("#resetMapBtn").click(function(){y.setView([48.874,2.358],15)})}function t(e){return e.replace(/\s/g,"").replace(/[^a-zA-Z 0-9]+/g,"").toLowerCase()}function o(e,o){b=[],$("input:checkbox[name=SMFilter]:checked").each(function(){b.push(t($(this).val()))}),$("#checkedNum").html(b.length+"<i>&nbsp;&nbsp;SMs selected</i>"),i(e,o)}function n(e){var t=[],o=[],n=[],i=[],a={};for(var r in e.features){var c=e.features[r].properties;void 0===o[c.Page]&&(t.push(c.Page),o[c.Page]=1),void 0===i[c.SM]&&(n.push(c.SM),i[c.SM]=1),void 0===a[c.SM]?a[c.SM]=1:a[c.SM]+=1}return{SMs:n,pages:t.sort(function(e,t){return e-t}),SMCount:a}}function i(e,o,n){y.hasLayer(g)&&y.removeLayer(g),g=L.geoJson(o,{filter:function(e){return n?e.properties.Page==n?!0:!1:-1!==$.inArray(t(e.properties.SM),b)?!0:!1},pointToLayer:function(e,t){return L.circle(t,100,{fillColor:PropColor(e.properties.SM),color:PropColor(e.properties.SM),weight:3,fillOpacity:.4}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#000000"})}})}}).addTo(y),a()}function a(){g.eachLayer(function(e){var t=e.feature.properties,o=100,n="<i><b>"+t.title+"</b></i> <br>"+t.description+"<br>page "+t.Page;e.setRadius(o),e.bindPopup(n,{offset:new L.Point(0,10)}),e.options.color=PropColor(t.SM),e.options.fillColor=PropColor(t.SM)})}function r(e,t,o){var n=L.control({position:"bottomright"});n.onAdd=function(){var n=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(n,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(n).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){i(t,o,this.value),$(".temporal-legend").text("on Page "+this.value)}),n},n.addTo(y),f(e[0])}function c(t,n){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),y.setView([48.876,2.357],15),clearInterval(v),m=150,l(t,n,m),e(t.SMs,t,n),o()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),s(t,n,m)}),$(".step").click(function(){s(),$(".pause").hide(),$(".play").show(),p(t,n)}),$(".back").click(function(){s(),$(".pause").hide(),$(".play").show(),u(t,n)}),$(".back-full").click(function(){s(),$(".pause").hide(),$(".play").show(),d(t,n)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),h(t,n)}),$(".faster").click(function(){m>100?(m-=100,clearInterval(v),l(t,n,m)):m=150}),$(".slower").click(function(){1e3>m?(m+=100,clearInterval(v),l(t,n,m),console.log(m)):m=250})}function l(e,t,o){v=setInterval(function(){p(e,t)},o)}function s(e,t,o){o=0,clearInterval(v)}function u(e,t,o){k>9&&k--,i(e,t,k,o),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function p(e,t,o){238>k&&k++,i(e,t,k,o),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function h(e,t){k=238,i(e,t,k),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function d(e,t){k=9,i(e,t,k),$("input[type=range]").val(k),$(".temporal-legend").text("on Page "+k)}function f(e){var t=L.control({position:"bottomright"});t.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},t.addTo(y),$(".temporal-legend").text("on Page "+e)}var g,m,v,b=[],k=9;L.mapbox.accessToken="pk.eyJ1Ijoiam9zaHVhLWFybXN0cm9uZyIsImEiOiJZM3dMR3pnIn0.6ZxWqnDdV6s-Tx9F6XKd1w";var y=L.mapbox.map("map","deanolsen1.m93pgn91",{zoomControl:!1,attributionControl:!1});y.setView([41.8369,-97.6847],4),new L.Control.Zoom({position:"topright"}).addTo(y),$(window).resize(function(){$("#sliderContainer").css("margin-right","0px"),$("#temporal-legend").css("margin-right","0px"),SizeMe(y)}),SizeMe(y),$.getJSON("data/lmtest1.geojson").done(function(t){var a=n(t);i(a,t),r(a.pages,a,t),e(a.SMs,a,t),o(a,t),c(a,t)}).fail(function(){alert("There has been a problem loading the data.")}),$(".buttonMin").click(function(){$(this).toggleClass("btn-plus"),$("div.scroll").slideToggle()})});